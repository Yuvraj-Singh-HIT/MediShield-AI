<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Climabot - AI Weather Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;600;700&display=swap');
      
      :root {
          --primary-glow: #6366f1;
          --secondary-glow: #a855f7;
          --accent-glow: #ec4899;
          --cyber-blue: #00d4ff;
          --neon-green: #39ff14;
          --electric-purple: #bf00ff;
      }

      body {
          font-family: 'Inter', sans-serif;
          background: #000000;
          color: #ffffff;
          overflow-x: hidden;
      }

      /* Advanced animated background */
      .cyber-bg {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          z-index: -3;
          background: 
              radial-gradient(circle at 15% 25%, rgba(0, 212, 255, 0.4) 0%, transparent 30%),
              radial-gradient(circle at 85% 75%, rgba(99, 102, 241, 0.5) 0%, transparent 40%),
              radial-gradient(circle at 45% 60%, rgba(168, 85, 247, 0.3) 0%, transparent 35%),
              radial-gradient(circle at 10% 80%, rgba(57, 255, 20, 0.3) 0%, transparent 30%),
              linear-gradient(135deg, #000000 0%, #0d1117 25%, #161b22 50%, #0d1117 75%, #000000 100%);
          animation: cosmic-drift 30s ease-in-out infinite alternate;
      }

      @keyframes cosmic-drift {
          0% { transform: scale(1) rotate(0deg); filter: hue-rotate(0deg); }
          50% { transform: scale(1.05) rotate(0.5deg); filter: hue-rotate(180deg); }
          100% { transform: scale(1.02) rotate(-0.3deg); filter: hue-rotate(360deg); }
      }

      /* Floating shapes */
      .floating-shapes {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          pointer-events: none;
          z-index: -2;
      }

      .shape {
          position: absolute;
          opacity: 0.08;
          filter: blur(1px);
      }

      .shape:nth-child(1) { 
          width: 100px; height: 100px; 
          top: 20%; left: 10%; 
          background: linear-gradient(45deg, var(--cyber-blue), var(--primary-glow));
          border-radius: 50%;
          animation: float-1 20s infinite linear;
      }
      .shape:nth-child(2) { 
          width: 60px; height: 60px; 
          top: 70%; left: 80%; 
          background: linear-gradient(135deg, var(--neon-green), var(--secondary-glow));
          transform: rotate(45deg);
          animation: float-2 25s infinite linear;
      }
      .shape:nth-child(3) { 
          width: 80px; height: 80px; 
          top: 85%; left: 20%; 
          background: linear-gradient(90deg, var(--accent-glow), var(--electric-purple));
          border-radius: 20px;
          animation: float-3 30s infinite linear;
      }

      @keyframes float-1 {
          0% { transform: translateY(0px) rotate(0deg); opacity: 0.05; }
          50% { transform: translateY(-30vh) rotate(180deg); opacity: 0.12; }
          100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
      }
      @keyframes float-2 {
          0% { transform: translateY(0px) rotate(45deg); opacity: 0.06; }
          50% { transform: translateY(-35vh) rotate(225deg); opacity: 0.14; }
          100% { transform: translateY(-100vh) rotate(405deg); opacity: 0; }
      }
      @keyframes float-3 {
          0% { transform: translateY(0px) rotate(0deg); opacity: 0.07; }
          50% { transform: translateY(-25vh) rotate(270deg); opacity: 0.13; }
          100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
      }

      /* Holographic navbar */
      .holo-nav {
          background: rgba(0, 0, 0, 0.85);
          backdrop-filter: blur(25px) saturate(200%);
          border-bottom: 2px solid transparent;
          background-image: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.85)), 
                           linear-gradient(90deg, var(--cyber-blue), var(--neon-green), var(--accent-glow));
          background-origin: border-box;
          background-clip: content-box, border-box;
          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.9), inset 0 1px 0 rgba(255, 255, 255, 0.15);
          position: relative;
      }

      .holo-nav::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 2px;
          background: linear-gradient(90deg, transparent 0%, var(--cyber-blue) 50%, transparent 100%);
          animation: scan-line 3s ease-in-out infinite;
      }

      @keyframes scan-line {
          0%, 100% { opacity: 0; transform: scaleX(0); }
          50% { opacity: 1; transform: scaleX(1); }
      }

      /* Ultra-modern gradient text */
      .ultra-gradient {
          background: linear-gradient(135deg, 
              #00d4ff 0%, 
              #6366f1 25%, 
              #a855f7 50%, 
              #ec4899 75%, 
              #39ff14 100%);
          background-size: 300% 300%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: rainbow-shift 4s ease-in-out infinite;
          filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.5));
      }

      @keyframes rainbow-shift {
          0%, 100% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
      }

      /* Ultra-modern gradient text */
      .ultra-gradient {
          background: linear-gradient(135deg, 
              #00d4ff 0%, 
              #6366f1 25%, 
              #a855f7 50%, 
              #ec4899 75%, 
              #39ff14 100%);
          background-size: 300% 300%;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          animation: rainbow-shift 4s ease-in-out infinite;
          filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.5));
      }

      @keyframes rainbow-shift {
          0%, 100% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
      }

      /* ChatGPT-style layout */
      .chat-container {
          height: calc(100vh - 80px);
          background: transparent;
          display: flex;
          flex-direction: column;
          max-width: 800px;
          margin: 0 auto;
          position: relative;
      }

      /* Chat Messages - ChatGPT Style */
      .chat-messages {
          flex: 1;
          overflow-y: auto;
          padding: 20px 0;
          position: relative;
          z-index: 10;
      }

      .message {
          margin-bottom: 24px;
          animation: message-appear 0.3s ease-out;
      }

      @keyframes message-appear {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
      }

      .user-message {
          display: flex;
          justify-content: flex-end;
          padding: 0 20px;
      }

      .user-message .message-content {
          background: rgba(0, 212, 255, 0.15);
          border: 1px solid rgba(0, 212, 255, 0.3);
          border-radius: 18px;
          padding: 12px 18px;
          max-width: 70%;
          position: relative;
          backdrop-filter: blur(10px);
          color: #ffffff;
          font-weight: 500;
      }

      .bot-message {
          display: flex;
          justify-content: flex-start;
          padding: 0 20px;
      }

      .bot-message .message-content {
          background: rgba(255, 255, 255, 0.05);
          border: 1px solid rgba(255, 255, 255, 0.1);
          border-radius: 18px;
          padding: 16px 20px;
          max-width: 85%;
          position: relative;
          backdrop-filter: blur(10px);
          color: #ffffff;
          line-height: 1.6;
      }

      .avatar {
          width: 32px;
          height: 32px;
          border-radius: 50%;
          margin-right: 12px;
          margin-top: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 16px;
          flex-shrink: 0;
      }

      .user-avatar {
          background: linear-gradient(135deg, var(--cyber-blue), var(--primary-glow));
          margin-left: 12px;
          margin-right: 0;
      }

      .bot-avatar {
          background: linear-gradient(135deg, var(--neon-green), var(--secondary-glow));
      }

      .welcome-message {
          background: rgba(168, 85, 247, 0.1);
          border: 1px solid rgba(168, 85, 247, 0.3);
          border-radius: 20px;
          padding: 24px;
          margin: 20px;
          text-align: center;
          backdrop-filter: blur(15px);
          position: relative;
          overflow: hidden;
      }

      .welcome-message::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(168, 85, 247, 0.2), transparent);
          animation: welcome-shimmer 3s ease-in-out infinite;
      }

      @keyframes welcome-shimmer {
          0%, 100% { left: -100%; }
          50% { left: 100%; }
      }

      /* Input area fixed at bottom - ChatGPT Style */
      .chat-input-area {
          position: sticky;
          bottom: 0;
          background: rgba(0, 0, 0, 0.9);
          backdrop-filter: blur(20px);
          border-top: 1px solid rgba(255, 255, 255, 0.1);
          padding: 20px;
          z-index: 20;
      }

      .input-container {
          max-width: 760px;
          margin: 0 auto;
          position: relative;
      }

      .chat-input-wrapper {
          position: relative;
          background: rgba(255, 255, 255, 0.05);
          border: 1px solid rgba(255, 255, 255, 0.2);
          border-radius: 12px;
          padding: 4px;
          backdrop-filter: blur(10px);
          transition: all 0.3s ease;
      }

      .chat-input-wrapper:focus-within {
          border-color: rgba(0, 212, 255, 0.5);
          box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
      }

      .holo-input {
          background: transparent;
          border: none;
          color: #ffffff;
          font-family: 'Inter', sans-serif;
          font-size: 16px;
          padding: 12px 50px 12px 16px;
          width: 100%;
          resize: none;
          outline: none;
          max-height: 120px;
          min-height: 24px;
          line-height: 1.5;
      }

      .holo-input::placeholder {
          color: rgba(255, 255, 255, 0.5);
          font-weight: 400;
      }

      /* Send button - ChatGPT style */
      .send-button {
          position: absolute;
          right: 8px;
          top: 50%;
          transform: translateY(-50%);
          width: 32px;
          height: 32px;
          border-radius: 8px;
          border: none;
          background: linear-gradient(135deg, var(--cyber-blue), var(--primary-glow));
          color: white;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
          opacity: 0.7;
      }

      .send-button:hover {
          opacity: 1;
          transform: translateY(-50%) scale(1.05);
      }

      .send-button:disabled {
          opacity: 0.3;
          cursor: not-allowed;
      }

      /* Weather context card */
      .weather-context {
          background: rgba(0, 212, 255, 0.1);
          border: 1px solid rgba(0, 212, 255, 0.3);
          border-radius: 16px;
          padding: 16px 20px;
          margin: 20px;
          backdrop-filter: blur(10px);
          transition: all 0.3s ease;
      }

      .weather-context:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 25px rgba(0, 212, 255, 0.2);
      }

      /* Logo styling */
      .logo-quantum {
          filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.8));
          animation: logo-pulse 3s ease-in-out infinite alternate;
          transition: all 0.3s ease;
      }

      .logo-quantum:hover {
          transform: scale(1.1) rotate(5deg);
          filter: drop-shadow(0 0 30px rgba(0, 212, 255, 1));
      }

      @keyframes logo-pulse {
          0% { filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.8)); }
          100% { filter: drop-shadow(0 0 35px rgba(57, 255, 20, 0.6)); }
      }

      /* Holographic text effects */
      .holo-text {
          background: linear-gradient(135deg, 
              rgba(0, 212, 255, 0.95) 0%, 
              rgba(255, 255, 255, 1) 50%,
              rgba(57, 255, 20, 0.95) 100%);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          filter: drop-shadow(0 0 10px rgba(0, 212, 255, 0.5));
          animation: holo-shimmer 2s ease-in-out infinite alternate;
      }

      @keyframes holo-shimmer {
          0% { filter: drop-shadow(0 0 10px rgba(0, 212, 255, 0.5)); }
          100% { filter: drop-shadow(0 0 20px rgba(57, 255, 20, 0.7)); }
      }

      /* Loading animation */
      .typing-indicator {
          display: flex;
          align-items: center;
          gap: 8px;
          color: rgba(255, 255, 255, 0.7);
          font-size: 14px;
          padding: 8px 0;
      }

      .typing-dots {
          display: flex;
          gap: 4px;
      }

      .typing-dot {
          width: 8px;
          height: 8px;
          background: rgba(0, 212, 255, 0.8);
          border-radius: 50%;
          animation: typing-bounce 1.4s ease-in-out infinite;
      }

      .typing-dot:nth-child(1) { animation-delay: 0s; }
      .typing-dot:nth-child(2) { animation-delay: 0.2s; }
      .typing-dot:nth-child(3) { animation-delay: 0.4s; }

      @keyframes typing-bounce {
          0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
          30% { transform: translateY(-8px); opacity: 1; }
      }

      /* Nav links */
      .nav-link {
          position: relative;
          transition: all 0.3s ease;
          padding: 8px 0;
      }

      .nav-link::before {
          content: '';
          position: absolute;
          bottom: -3px;
          left: 50%;
          width: 0;
          height: 2px;
          background: linear-gradient(90deg, var(--cyber-blue), var(--neon-green));
          transition: all 0.3s ease;
          transform: translateX(-50%);
          border-radius: 1px;
      }

      .nav-link:hover::before {
          width: 100%;
      }

      .nav-link:hover {
          transform: translateY(-2px);
          text-shadow: 0 0 15px rgba(0, 212, 255, 0.7);
      }

      /* Scrollbar styling */
      .chat-messages::-webkit-scrollbar {
          width: 6px;
      }
      .chat-messages::-webkit-scrollbar-track {
          background: transparent;
      }
      .chat-messages::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.2);
          border-radius: 3px;
      }
      .chat-messages::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.3);
      }

      /* Mobile responsiveness */
      @media (max-width: 768px) {
          .chat-messages {
              padding: 15px 0;
          }
          .user-message, .bot-message {
              padding: 0 16px;
          }
          .user-message .message-content,
          .bot-message .message-content {
              max-width: 90%;
          }
          .chat-input-area {
              padding: 16px;
          }
          .welcome-message {
              margin: 16px;
              padding: 20px;
          }
          .weather-context {
              margin: 16px;
          }
      }

      .mobile-menu {
          background: rgba(0, 0, 0, 0.95);
          backdrop-filter: blur(30px);
          border: 2px solid rgba(0, 212, 255, 0.3);
          border-radius: 1rem;
          transform: translateY(-10px) scale(0.95);
          opacity: 0;
          transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      .mobile-menu.active {
          transform: translateY(0) scale(1);
          opacity: 1;
      }

      /* Error message styling */
      .error-message .message-content {
          background: rgba(239, 68, 68, 0.1);
          border-color: rgba(239, 68, 68, 0.3);
          color: #fca5a5;
      }

      /* Code blocks in messages */
      .message-content code {
          background: rgba(0, 0, 0, 0.3);
          padding: 2px 6px;
          border-radius: 4px;
          font-family: 'JetBrains Mono', monospace;
          font-size: 0.9em;
      }

      .message-content pre {
          background: rgba(0, 0, 0, 0.3);
          padding: 12px;
          border-radius: 8px;
          overflow-x: auto;
          margin: 8px 0;
      }

      .message-content pre code {
          background: none;
          padding: 0;
      }

      /* Status indicator */
      .status-indicator {
          display: flex;
          align-items: center;
          gap: 8px;
          font-size: 12px;
          color: rgba(255, 255, 255, 0.5);
          margin-top: 8px;
      }

      .status-dot {
          width: 8px;
          height: 8px;
          border-radius: 50%;
          background: #10b981;
          animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
      }
        @keyframes context-highlight {
        0% { box-shadow: 0 0 0 rgba(0, 212, 255, 0); }
        50% { box-shadow: 0 0 30px rgba(0, 212, 255, 0.5); }
        100% { box-shadow: 0 0 0 rgba(0, 212, 255, 0); }
     }

        .weather-context {
            position: relative;
        }

        .weather-context::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, transparent, rgba(0, 212, 255, 0.3), transparent);
            border-radius: 18px;
            z-index: -1;
            opacity: 0;
            animation: border-glow 3s ease-in-out infinite;
        }

        @keyframes border-glow {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- Advanced background -->
  <div class="cyber-bg"></div>
  
  <!-- Floating geometric shapes -->
  <div class="floating-shapes">
      <div class="shape"></div>
      <div class="shape"></div>
      <div class="shape"></div>
  </div>

    <!-- Holographic Navbar -->
    <nav class="holo-nav py-6 px-6 md:px-13 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center space-x-4">
            <div class="logo-quantum">
                <svg width="40" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M36 20C36 16.6863 33.3137 14 30 14C29.3372 14 28.7142 14.1431 28.1538 14.4016C27.1507 12.0648 24.8082 10.5 22.08 10.5C18.6994 10.5 15.9 13.2994 15.9 16.68" fill="url(#quantumGradient1)"/>
                    <path d="M24 29L19 37H24L22.5 42L28.5 34H23L24 29Z" fill="url(#quantumGradient2)"/>
                    <circle cx="12" cy="15" r="1.5" fill="url(#quantumGradient3)" opacity="0.8"/>
                    <circle cx="38" cy="25" r="1" fill="url(#quantumGradient3)" opacity="0.6"/>
                    <defs>
                        <linearGradient id="quantumGradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#00d4ff;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#6366f1;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="quantumGradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#39ff14;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#00d4ff;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="quantumGradient3" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ec4899;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#a855f7;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <span class="text-2xl font-black holo-text tracking-wider">CLIMABOT</span>
        </div>
        <div class="hidden md:flex space-x-8 pr-4">
            <a href="index.html" class="nav-link text-gray-300 hover:text-cyan-400 font-bold text-lg">HOME</a>
            <a href="weather.html" onclick="app.navigateToChat(); return false;" class="nav-link text-gray-300 hover:text-purple-400 font-bold text-lg">WEATHER</a>
            <a href="chatbot.html" onclick="app.navigateToChat(); return false;" class="nav-link text-gray-300 hover:text-purple-400 font-bold text-lg">CHATBOT</a>
            <a href="about.html" class="nav-link text-gray-300 hover:text-pink-400 font-bold text-lg">ABOUT</a>
            <a href="contact.html" class="nav-link text-gray-300 hover:text-green-400 font-bold text-lg">CONTACT</a>
        </div>
        <button id="mobile-menu-btn" class="md:hidden text-gray-300 hover:text-cyan-400 focus:outline-none transition-all duration-300 transform hover:scale-110">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>
    </nav>
  <!-- Mobile Menu -->
  <div id="mobile-menu" class="mobile-menu hidden md:hidden absolute top-16 right-6 z-40 p-6 space-y-4">
      <a href="index.html" class="block text-gray-300 hover:text-cyan-400 font-medium">Home</a>
      <a href="index.htmlweather.html" class="block text-gray-300 hover:text-cyan-400 font-medium">Weather</a>
      <a href="chatbot.html" class="block text-gray-300 hover:text-purple-400 font-medium">Chatbot</a>
      <a href="about.html" class="block text-gray-300 hover:text-pink-400 font-medium">About</a>
      <a href="contact.html" class="block text-gray-300 hover:text-green-400 font-medium">Contact</a>
  </div>

  <!-- Main Chat Interface -->
  <main class="flex-grow">
      <div class="chat-container">
            <!-- 1. Enhanced Weather Context Card Display (Replace the existing weather-context div) -->
            <div id="weather-context" class="weather-context hidden">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="text-3xl" id="context-icon">üå°Ô∏è</div>
                        <div>
                            <h3 class="font-bold text-xl text-cyan-400" id="context-location">Current Location</h3>
                            <p class="text-base text-gray-300" id="context-temp">Temperature data available</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-gray-500 uppercase tracking-wide">Last Updated</p>
                        <p class="text-cyan-400 font-mono text-sm font-semibold" id="context-time">--</p>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-cyan-500/10 to-blue-500/10 border border-cyan-500/30 rounded-lg p-4">
                    <p class="text-green-400 font-semibold text-center">
                        ü§ñ I have context about <span id="context-location-name" class="text-cyan-300 font-bold"></span>'s weather!
                    </p>
                    <p class="text-gray-300 text-sm text-center mt-2">
                        Ask me anything about this location's weather conditions, forecasts, or climate insights.
                    </p>
                </div>
            </div>

          <!-- Chat Messages Area -->
          <div class="chat-messages" id="chat-messages">
              <!-- Messages will be inserted here -->
          </div>

          <!-- Chat Input Area -->
          <div class="chat-input-area">
              <div class="input-container">
                  <div class="chat-input-wrapper">
                      <textarea
                          id="chat-input"
                          placeholder="Ask me about weather, climate, forecasts..."
                          class="holo-input"
                          rows="1"
                          maxlength="2000"
                      ></textarea>
                      <button
                          id="send-button"
                          class="send-button"
                          title="Send message"
                      >
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                              <path d="M7 11L12 6L17 11M12 18V7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                      </button>
                  </div>
                  <div class="status-indicator">
                      <div class="status-dot"></div>
                      <span>Connected to Climabot AI</span>
                  </div>
              </div>
          </div>
      </div>
  </main>

  <script>
      class ClimabotAI {
          constructor() {
              this.currentWeatherData = null;
              this.conversationHistory = [];
              this.isTyping = false;
              this.init();
          }

          init() {
              this.loadStoredData();
              this.bindEvents();
              this.showWelcomeMessage();
              this.loadWeatherContext();
              this.setupParticleSystem();
              this.autoResizeTextarea();
          }

          loadStoredData() {
              // Load weather data from localStorage or URL params
              const weatherData = localStorage.getItem('climabot_weather_data');
              if (weatherData) {
                  try {
                      this.currentWeatherData = JSON.parse(weatherData);
                      this.displayWeatherContext();
                  } catch (e) {
                      console.log('No valid weather data found');
                  }
              }
          }

          bindEvents() {
              // Chat input events
              const chatInput = document.getElementById('chat-input');
              const sendButton = document.getElementById('send-button');
              
              chatInput.addEventListener('keydown', (e) => {
                  if (e.key === 'Enter' && !e.shiftKey) {
                      e.preventDefault();
                      this.sendMessage();
                  }
              });

              chatInput.addEventListener('input', (e) => {
                  this.autoResizeTextarea();
                  const hasText = e.target.value.trim().length > 0;
                  sendButton.style.opacity = hasText ? '1' : '0.7';
              });

              sendButton.addEventListener('click', () => this.sendMessage());

              // Mobile menu
              const mobileMenuBtn = document.getElementById('mobile-menu-btn');
              const mobileMenu = document.getElementById('mobile-menu');

              if (mobileMenuBtn && mobileMenu) {
                  mobileMenuBtn.addEventListener('click', () => {
                      mobileMenu.classList.toggle('hidden');
                      if (!mobileMenu.classList.contains('hidden')) {
                          setTimeout(() => mobileMenu.classList.add('active'), 10);
                      } else {
                          mobileMenu.classList.remove('active');
                      }
                  });

                  document.addEventListener('click', (e) => {
                      if (!mobileMenu.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                          mobileMenu.classList.add('hidden');
                          mobileMenu.classList.remove('active');
                      }
                  });
              }
          }

          autoResizeTextarea() {
              const textarea = document.getElementById('chat-input');
              textarea.style.height = 'auto';
              textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
          }

          setupParticleSystem() {
              setInterval(() => {
                  this.createRandomParticle();
              }, 3000);
          }

          createRandomParticle() {
              const shapes = document.querySelector('.floating-shapes');
              if (!shapes) return;

              const particle = document.createElement('div');
              particle.className = 'shape';
              particle.style.cssText = `
                  position: absolute;
                  width: 4px;
                  height: 4px;
                  background: ${this.getRandomColor()};
                  border-radius: 50%;
                  left: ${Math.random() * 100}%;
                  top: 100%;
                  opacity: 0.6;
                  animation: float-particle 6s linear forwards;
              `;
              
              shapes.appendChild(particle);
              
              setTimeout(() => {
                  if (particle.parentNode) {
                      particle.remove();
                  }
              }, 6000);
          }

          getRandomColor() {
              const colors = [
                  'rgba(0, 212, 255, 0.8)',
                  'rgba(57, 255, 20, 0.8)',
                  'rgba(236, 72, 153, 0.8)',
                  'rgba(168, 85, 247, 0.8)'
              ];
              return colors[Math.floor(Math.random() * colors.length)];
          }

         loadWeatherContext() {
                    // Try to get weather data from URL params first (from main page)
                    const urlParams = new URLSearchParams(window.location.search);
                    const location = urlParams.get('location');
                    const temp = urlParams.get('temp');
                    const condition = urlParams.get('condition');

                    if (location && temp) {
                        this.currentWeatherData = {
                            location: decodeURIComponent(location),
                            name: decodeURIComponent(location),
                            temperature: parseFloat(temp),
                            condition: decodeURIComponent(condition) || 'Unknown',
                            timestamp: new Date().toISOString()
                        };
                        localStorage.setItem('climabot_weather_data', JSON.stringify(this.currentWeatherData));
                        this.displayWeatherContext();
                        
                        // Clear URL params to clean up the URL
                        window.history.replaceState({}, document.title, window.location.pathname);
                        
                        return true;
                    }
                    
                    // Fallback to localStorage if no URL params
                    const storedData = localStorage.getItem('climabot_weather_data');
                    if (storedData) {
                        try {
                            this.currentWeatherData = JSON.parse(storedData);
                            this.displayWeatherContext();
                            return true;
                        } catch (e) {
                            console.log('Invalid stored weather data');
                            localStorage.removeItem('climabot_weather_data');
                        }
                    }
                    
                    return false;
                }

                displayWeatherContext() {
                    if (!this.currentWeatherData) return;

                    // UI elements
                    const contextCard = document.getElementById('weather-context');
                    const contextLocation = document.getElementById('context-location');
                    const contextTemp = document.getElementById('context-temp');
                    const contextTime = document.getElementById('context-time');
                    const contextIcon = document.getElementById('context-icon');
                    const contextLocationName = document.getElementById('context-location-name');

                    if (!contextCard) return;

                    // Update UI
                    if (contextLocation) {
                        contextLocation.textContent = this.currentWeatherData.location;
                    }
                    
                    if (contextTemp) {
                        contextTemp.textContent = `${this.currentWeatherData.temperature}¬∞C ‚Ä¢ ${this.currentWeatherData.condition}`;
                    }

                    if (contextLocationName) {
                        contextLocationName.textContent = this.currentWeatherData.location;
                    }

                    if (contextTime && this.currentWeatherData.timestamp) {
                        const time = new Date(this.currentWeatherData.timestamp);
                        contextTime.textContent = time.toLocaleTimeString();
                    }

                    if (contextIcon) {
                        contextIcon.textContent = this.getWeatherEmoji(this.currentWeatherData.condition);
                    }

                    contextCard.classList.remove('hidden');

                    // Add animation with delay
                    setTimeout(() => {
                        contextCard.style.animation = 'context-highlight 2s ease-in-out';
                    }, 500);
                }

                // Add this helper function for weather emojis
                getWeatherEmoji(condition) {
                    const emojiMap = {
                        'Clear': '‚òÄÔ∏è',
                        'Clouds': '‚òÅÔ∏è',
                        'Rain': 'üåßÔ∏è',
                        'Drizzle': 'üå¶Ô∏è',
                        'Thunderstorm': '‚õàÔ∏è',
                        'Snow': '‚ùÑÔ∏è',
                        'Mist': 'üå´Ô∏è',
                        'Fog': 'üå´Ô∏è',
                        'Haze': 'üå´Ô∏è',
                        'Dust': 'üå™Ô∏è',
                        'Sand': 'üå™Ô∏è',
                        'Ash': 'üåã',
                        'Squall': 'üí®',
                        'Tornado': 'üå™Ô∏è'
                    };
                    return emojiMap[condition] || 'üå°Ô∏è';
                }

                // Update the loadStoredData function
                loadStoredData() {
                    // Load weather data from localStorage or URL params
                    const hasContext = this.loadWeatherContext();
                    
                    if (hasContext) {
                        // Show a brief notification that context was loaded
                        setTimeout(() => {
                            this.showContextLoadedNotification();
                        }, 1000);
                    }
                }

            // Enhanced welcome message with better weather context awareness
            showWelcomeMessage() {
                const messagesContainer = document.getElementById('chat-messages');
                
                let welcomeText = `
                    <div class="text-center">
                        <div class="text-4xl mb-4">ü§ñ</div>
                        <h3 class="text-2xl font-bold mb-4 ultra-gradient">Welcome to Climabot AI!</h3>
                        <p class="text-lg mb-4 text-gray-300">I'm your intelligent weather assistant powered by advanced AI.</p>
                `;

                if (this.currentWeatherData) {
                    welcomeText += `
                        <div class="bg-gradient-to-r from-green-500/10 to-emerald-500/10 border border-green-500/30 rounded-lg p-4 mb-4 backdrop-filter backdrop-blur-sm">
                            <p class="text-green-300 font-bold text-lg mb-3">üéØ Weather Context Loaded!</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                                <div class="bg-black/20 rounded-lg p-3">
                                    <span class="text-gray-400 block text-xs uppercase">Location</span> 
                                    <span class="text-white font-bold text-lg">${this.currentWeatherData.location}</span>
                                </div>
                                <div class="bg-black/20 rounded-lg p-3">
                                    <span class="text-gray-400 block text-xs uppercase">Temperature</span> 
                                    <span class="text-white font-bold text-lg">${this.currentWeatherData.temperature}¬∞C</span>
                                </div>
                                <div class="bg-black/20 rounded-lg p-3">
                                    <span class="text-gray-400 block text-xs uppercase">Conditions</span> 
                                    <span class="text-white font-bold text-lg">${this.currentWeatherData.condition}</span>
                                </div>
                            </div>
                            <div class="mt-4 p-3 bg-cyan-500/10 border border-cyan-500/30 rounded-lg">
                                <p class="text-cyan-300 font-semibold">‚ú® Smart Context Active</p>
                                <p class="text-gray-300 text-sm mt-1">I can provide detailed insights about ${this.currentWeatherData.location}'s weather patterns, comparisons, forecasts, and recommendations based on these current conditions!</p>
                            </div>
                        </div>
                    `;
                } else {
                    welcomeText += `
                        <div class="bg-purple-500/10 border border-purple-500/30 rounded-lg p-4 mb-4 backdrop-filter backdrop-blur-sm">
                            <p class="text-purple-300 font-semibold mb-2">üí° Pro Tip</p>
                            <p class="text-gray-300 text-sm">Check the weather on the main page first for context-aware responses! I'll remember the location and provide much more detailed, relevant answers.</p>
                            <div class="mt-3 flex justify-center">
                                <a href="index.html" class="inline-flex items-center space-x-2 bg-purple-500/20 hover:bg-purple-500/30 border border-purple-500/50 rounded-lg px-4 py-2 text-purple-300 hover:text-purple-200 transition-all duration-300">
                                    <span>üåç</span>
                                    <span class="font-semibold">Get Weather First</span>
                                </a>
                            </div>
                        </div>
                    `;
                }

                welcomeText += `
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-6 text-sm">
                            <div class="flex flex-col items-center space-y-1 p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-all duration-300">
                                <span class="text-xl">üå§Ô∏è</span>
                                <span class="text-gray-300 font-medium">Forecasts</span>
                            </div>
                            <div class="flex flex-col items-center space-y-1 p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-all duration-300">
                                <span class="text-xl">üåç</span>
                                <span class="text-gray-300 font-medium">Climate</span>
                            </div>
                            <div class="flex flex-col items-center space-y-1 p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-all duration-300">
                                <span class="text-xl">üå™Ô∏è</span>
                                <span class="text-gray-300 font-medium">Alerts</span>
                            </div>
                            <div class="flex flex-col items-center space-y-1 p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-all duration-300">
                                <span class="text-xl">üìä</span>
                                <span class="text-gray-300 font-medium">Analysis</span>
                            </div>
                        </div>
                    </div>
                `;

                const welcomeMessage = document.createElement('div');
                welcomeMessage.className = 'welcome-message';
                welcomeMessage.innerHTML = welcomeText;
                
                messagesContainer.appendChild(welcomeMessage);
                this.scrollToBottom();
            }

            // New function to show context loaded notification
            showContextLoadedNotification() {
                if (!this.currentWeatherData) return;
                
                const notification = document.createElement('div');
                notification.className = 'fixed top-20 right-6 bg-green-500/20 border border-green-500/50 backdrop-filter backdrop-blur-sm rounded-lg p-4 z-50 transform translate-x-full transition-transform duration-500';
                notification.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="text-2xl">‚úÖ</div>
                        <div>
                            <p class="text-green-300 font-bold">Weather Context Loaded!</p>
                            <p class="text-gray-300 text-sm">Ready for ${this.currentWeatherData.location} insights</p>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Slide in
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                // Slide out and remove
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 500);
                }, 4000);
            }
          async sendMessage() {
              const chatInput = document.getElementById('chat-input');
              const message = chatInput.value.trim();

              if (!message || this.isTyping) return;

              // Add user message
              this.addMessage(message, 'user');
              chatInput.value = '';
              this.autoResizeTextarea();

              // Show typing indicator
              this.showTypingIndicator();

              try {
                  // Call your backend API endpoint instead of direct Gemini API
                  const response = await this.callBackendAPI(message);
                  this.hideTypingIndicator();
                  this.addMessage(response, 'bot');
              } catch (error) {
                  this.hideTypingIndicator();
                  this.addMessage(`I apologize, but I'm having trouble connecting to my weather services right now. Please try again in a moment.`, 'bot', true);
                  console.error('API Error:', error);
              }
          }

        // Updated callBackendAPI method for your ClimabotAI class
        async callBackendAPI(message) {
            const contextPrompt = this.buildContextPrompt(message);
            
            try {
                console.log('Sending request to /api/chat...'); // Debug log
                
                const requestBody = {
                    message: contextPrompt,
                    weatherContext: this.currentWeatherData,
                    conversationHistory: this.conversationHistory.slice(-6) // Last 3 exchanges
                };
                
                console.log('Request body:', requestBody); // Debug log
                
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                console.log('Response status:', response.status); // Debug log
                console.log('Response headers:', Object.fromEntries(response.headers.entries())); // Debug log

                // Get response text first for better error handling
                const responseText = await response.text();
                console.log('Raw response:', responseText); // Debug log

                if (!response.ok) {
                    let errorData;
                    try {
                        errorData = JSON.parse(responseText);
                    } catch (e) {
                        errorData = { error: 'Invalid response format', details: responseText };
                    }
                    
                    console.error('API Error Response:', errorData);
                    
                    // Handle specific error types
                    if (response.status === 400) {
                        throw new Error('Invalid request format. Please try again.');
                    } else if (response.status === 401) {
                        throw new Error('Authentication failed. Please check API configuration.');
                    } else if (response.status === 403) {
                        throw new Error('Access forbidden. Please check API permissions.');
                    } else if (response.status === 429) {
                        throw new Error('Too many requests. Please wait a moment and try again.');
                    } else if (response.status >= 500) {
                        throw new Error('Server error. Please try again later.');
                    } else {
                        throw new Error(errorData.error || `HTTP ${response.status}: ${response.statusText}`);
                    }
                }

                // Parse successful response
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (e) {
                    console.error('Failed to parse JSON response:', responseText);
                    throw new Error('Invalid response format from server');
                }

                if (!data.response) {
                    console.error('No response field in data:', data);
                    throw new Error('Invalid response structure from server');
                }

                return data.response;

            } catch (error) {
                console.error('API call failed:', error);
                
                // If it's a network error, provide a user-friendly message
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error('Unable to connect. Please check your internet connection and try again.');
                }
                
                // Re-throw the error to be handled by the calling function
                throw error;
            }
        }

          buildContextPrompt(userMessage) {
              let prompt = `You are Climabot AI, an advanced weather assistant. You provide helpful, accurate, and engaging responses about weather, climate, and atmospheric conditions.

Instructions:
- Be conversational and friendly
- Use weather emojis appropriately  
- Provide accurate information
- If you don't know something specific, be honest
- Keep responses informative but concise
- Focus on being helpful for weather-related queries

`;

              if (this.currentWeatherData) {
                  prompt += `Current Weather Context:
- Location: ${this.currentWeatherData.location}
- Temperature: ${this.currentWeatherData.temperature}¬∞C
- Conditions: ${this.currentWeatherData.condition}
- Data from: ${new Date(this.currentWeatherData.timestamp).toLocaleString()}

`;
              }

              // Add recent conversation history
              const recentHistory = this.conversationHistory.slice(-6);
              if (recentHistory.length > 0) {
                  prompt += "Recent conversation:\n";
                  recentHistory.forEach(entry => {
                      prompt += `${entry.type}: ${entry.message}\n`;
                  });
                  prompt += "\n";
              }

              prompt += `User Question: ${userMessage}

Please provide a helpful response:`;

              return prompt;
          }

          addMessage(message, type, isError = false) {
              const messagesContainer = document.getElementById('chat-messages');
              const messageElement = document.createElement('div');
              messageElement.className = `message ${type}-message${isError ? ' error-message' : ''}`;

              const avatar = document.createElement('div');
              avatar.className = `avatar ${type}-avatar`;
              avatar.textContent = type === 'user' ? 'üë§' : 'ü§ñ';

              const messageContent = document.createElement('div');
              messageContent.className = 'message-content';
              messageContent.innerHTML = this.formatMessage(message);

              if (type === 'user') {
                  messageElement.appendChild(messageContent);
                  messageElement.appendChild(avatar);
              } else {
                  messageElement.appendChild(avatar);
                  messageElement.appendChild(messageContent);
              }

              messagesContainer.appendChild(messageElement);
              
              // Add to conversation history
              this.conversationHistory.push({
                  type: type === 'user' ? 'User' : 'Assistant',
                  message: message,
                  timestamp: new Date().toISOString()
              });

              // Keep only last 20 exchanges
              if (this.conversationHistory.length > 40) {
                  this.conversationHistory = this.conversationHistory.slice(-40);
              }

              this.scrollToBottom();
          }

          formatMessage(message) {
              // Convert markdown-like formatting to HTML
              return message
                  .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                  .replace(/\*(.*?)\*/g, '<em>$1</em>')
                  .replace(/`(.*?)`/g, '<code>$1</code>')
                  .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                  .replace(/\n/g, '<br>');
          }

          showTypingIndicator() {
              this.isTyping = true;
              const messagesContainer = document.getElementById('chat-messages');
              const typingElement = document.createElement('div');
              typingElement.className = 'message bot-message typing-indicator-message';
              
              const avatar = document.createElement('div');
              avatar.className = 'avatar bot-avatar';
              avatar.textContent = 'ü§ñ';

              const typingContent = document.createElement('div');
              typingContent.className = 'message-content';
              typingContent.innerHTML = `
                  <div class="typing-indicator">
                      <span>Analyzing weather data</span>
                      <div class="typing-dots">
                          <div class="typing-dot"></div>
                          <div class="typing-dot"></div>
                          <div class="typing-dot"></div>
                      </div>
                  </div>
              `;

              typingElement.appendChild(avatar);
              typingElement.appendChild(typingContent);
              messagesContainer.appendChild(typingElement);
              this.scrollToBottom();
          }

          hideTypingIndicator() {
              this.isTyping = false;
              const typingElement = document.querySelector('.typing-indicator-message');
              if (typingElement) {
                  typingElement.remove();
              }
          }

          scrollToBottom() {
              const messagesContainer = document.getElementById('chat-messages');
              messagesContainer.scrollTop = messagesContainer.scrollHeight;
          }
      }

      // Add particle animation styles
      const style = document.createElement('style');
      style.textContent = `
          @keyframes float-particle {
              0% { transform: translateY(0px) scale(0); opacity: 0; }
              10% { opacity: 0.6; transform: translateY(-10vh) scale(1); }
              90% { opacity: 0.3; transform: translateY(-90vh) scale(0.8); }
              100% { transform: translateY(-100vh) scale(0); opacity: 0; }
          }
      `;
      document.head.appendChild(style);

      // Initialize the app
      document.addEventListener('DOMContentLoaded', () => {
          new ClimabotAI();
      });
  </script>
</body>
</html>